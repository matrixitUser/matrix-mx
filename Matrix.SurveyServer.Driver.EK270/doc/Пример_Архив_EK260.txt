***************************************************************
*	Пример процесса считывания данных ЕК260 и интервального архива.
***************************************************************

****************************************************************
*Условные обозначения
*<SOH> - 01Hex
*<STX> - 02Hex
*<ETX> - 03Hex
*<EOT> - 04Hex
*<BCC> - контрольная сумма. 
*
*Контрольная сумма рассчитывается как логическая операция XOR "веса" всех символов следующих за 
*первым символом после <STX>  или <SOH> и включая <ETX>.
*
*<ACK> - положительное квитирование
*<NAK> - отрицательное квитирование
*
*
* Формат запроса/команды: 
*
*<SOH> {R1(запись)/W1(чтение)} <STX> {адрес в формате YY:XXXX_X.X}(значение) <ETX> <BCC>
*
* Формат ответа на запрос:
* <STX> {адрес в формате YY:XXXX_X.X}(значение)<ETX> <BCC>
* 
* Формат ответа на команду записи:
* <ACK> - в случае успешного выполнения
* <NAK> - в случае ошибки
*****************************************************************

*****************************************************************
*Начало сеанса связи: определение конечного устройства, согласование скорости и т.д.
*Сеанс начинается на скорости установленной в настройках интерфейса корректора.
*****************************************************************	
	
/?!						- начало сеанса от ПК
/Els6EK260		- идентификация, важна цифра в 4-ой позиции - это скорость б/с (0 - 300, 1 - 600 и т.д. до 6 - 19200)
<ACK>					- от ПК символ <АСК> (подтверждение положительное от ПК)
061						- от ПК подтверждение выбора опций (0 - "нормальная" процедура протокола, 6 - см. скорость, 1 - режим программирования)

******************************************************************
*Далее связь происходит на скорости согласованной в начале сеанса
******************************************************************

<SOH>P0<STX>(1234567)<ETX>P				- от ЕК, псевдо команда пароля, не изменяется
<SOH>W1<STX>4:171.0(0)<ETX>q 			- от ПК, посылка кода доступа потребителя 
<ACK>															- от ЕК, подтверждение записи
<SOH>R1<STX>1:181.0(1)<ETX>			- см.адреса запрашиваемых данных в РЭ ЕК260
<STX>1:181.0(EK260)<ETX>
<SOH>R1<STX>2:190.0(1)<ETX>|
<STX>2:190.0(2.2)<ETX><STX>
<SOH>R1<STX>1:180.0(1)<ETX>~
<STX>1:180.0(4003189)<ETX>
<SOH>R1<STX>2:302.2(1)<ETX>w
<STX>7-2:302.2(68276.6694*m3)<ETX>W
<SOH>R1<STX>2:300.2(1)<ETX>u
<STX>7-2:300.2(68222.5379*m3)<ETX>Q
<SOH>R1<STX>2:303.2(1)<ETX>v
<STX>7-2:303.2(68276.6694*m3)<ETX>V
<SOH>R1<STX>4:302.2(1)<ETX>q
<STX>7-4:302.2(71757*m3)<ETX>|
<SOH>R1<STX>4:300.2(1)<ETX>s
<STX>7-4:300.2(71699*m3)<ETX>}
<SOH>R1<STX>4:303.2(1)<ETX>p
<STX>7-4:303.2(71757*m3)<ETX>}
<SOH>R1<STX>7:310.1(1)<ETX>r
<STX>7-7:310.1(1.00755* bar)<ETX>k
<SOH>R1<STX>6:310.1(1)<ETX>s
<STX>7-6:310.1(292.05*K)<ETX>J
<SOH>R1<STX>2:170.0(1)<ETX>r
<STX>2:170.0(0)<ETX>
<SOH>R1<STX>3:170.0(1)<ETX>s
<STX>3:170.0(0)<ETX>
<SOH>R1<STX>4:170.0(1)<ETX>t
<STX>4:170.0(1)<ETX>
<SOH>R1<STX>3:B04.0(1)<ETX><ETX>
<STX>3:B04.0(3)<ETX>`
<SOH>R1<STX>3:A32.0(1)<ETX>
<STX>3:A32.0(33)<ETX>U

*************************************************
*запрос заголовка архива
*************************************************

<SOH>R1<STX>3:V.2(1)<ETX> 	
<STX>(GONo)(AONo)(Time)(Vb)(VbT)(V)(Vo)(p.MP )(T.MP)(K.MP)(C.MP)(St.2)(St.4)(St.7)(St.6)(St.Sy)(StAe)(Er.Ch)<ETX>

*************************************************
*запрос единиц измерений
*************************************************
<SOH>R1<STX>3:V.3(1)<ETX>	
<STX>()()()(m3)(m3)(m3)(m3)( bar)({C)()()()()()()()()()<ETX>j

*************************************************
*отсюда и до запроса содержимого архива идет формирование "шапки" файла архива, 
*адреса берутся из файла "archiv.def" СОДЭКа
*************************************************
<SOH>R1<STX>2:190.0(1)<ETX>|	
<STX>2:190.0(2.2)<ETX><STX>
<SOH>R1<STX>1:101.3(1)<ETX>t<STX>1:101.3(0)<ETX>
<SOH>R1<STX>4:150.0(1)<ETX>v<STX>4:150.0(60*minutes)<ETX>w
<SOH>R1<STX>2:141.0(1)<ETX>p<STX>2:141.0(6*hours)<ETX>O
<SOH>R1<STX>1:21A.0(1)<ETX><STX>1:21A.0(0)<ETX>e
<SOH>R1<STX>1:222.0(1)<ETX>u<STX>1:222.0(000000000000)<ETX>%
<SOH>R1<STX>4:32D.0(1)<ETX><STX>4:32D.0(4043189)<ETX>d
<SOH>R1<STX>1:202.2(1)<ETX>u
<STX>7-1:202.2(71757*m3)<ETX>x
<SOH>R1<STX>4:303.2(1)<ETX>p
<STX>7-4:303.2(71757*m3)<ETX>}
<SOH>R1<STX>4:308.0(1)<ETX>y
<STX>4:308.0(m3)<ETX>w
<SOH>R1<STX>4:32E.0(1)<ETX><ACK>
<STX>4:32E.0(4033189)<ETX>b
<SOH>R1<STX>4:300.2(1)<ETX>s
<STX>7-4:300.2(71699*m3)<ETX>}
<SOH>R1<STX>4:303.2(1)<ETX>p
<STX>7-4:303.2(71757*m3)<ETX>}
<SOH>R1<STX>4:308.0(1)<ETX>y
<STX>4:308.0(m3)<ETX>w
<SOH>R1<STX>2:32E.0(1)<ETX>
<STX>2:32E.0(4013189)<ETX>f
<SOH>R1<STX>2:300.2(1)<ETX>u
<STX>7-2:300.2(68222.5379*m3)<ETX>Q
<SOH>R1<STX>2:303.2(1)<ETX>v
<STX>7-2:303.2(68276.6694*m3)<ETX>V
<SOH>R1<STX>4:308.0(1)<ETX>y
<STX>4:308.0(m3)<ETX>w
<SOH>R1<STX>2:32D.0(1)<ETX><SOH>
<STX>2:32D.0(4023189)<ETX>d
<SOH>R1<STX>2:302.2(1)<ETX>w
<STX>7-2:302.2(68276.6694*m3)<ETX>W
<SOH>R1<STX>2:303.2(1)<ETX>v
<STX>7-2:303.2(68276.6694*m3)<ETX>V
<SOH>R1<STX>4:308.0(1)<ETX>y
<STX>4:308.0(m3)<ETX>w
<SOH>R1<STX>7:32D.0(1)<ETX>
<STX>7:32D.0(4073189)<ETX>d
<SOH>R1<STX>7:310.1(1)<ETX>r
<STX>7-7:310.1(1.00755* bar)<ETX>k
<SOH>R1<STX>6:225.0(1)<ETX>u
<STX>6:225.0(2* bar)<ETX>l
<SOH>R1<STX>7:3310.0(1)<ETX>@
<STX>7:3310.0( bar)<ETX>A
<SOH>R1<STX>6:32D.0(1)<ETX>
<STX>6:32D.0(4063189)<ETX>d
<SOH>R1<STX>6:310.1(1)<ETX>s
<STX>7-6:310.1(292.05*K)<ETX>J
<SOH>R1<STX>8:32D.0(1)<ETX>
<STX>8:32D.0(4083189)<ETX>d
<SOH>R1<STX>8:310.1(1)<ETX>}
<STX>7-8:310.1(1)<ETX><ACK>
<SOH>R1<STX>5:32D.0(1)<ETX>v
<STX>5:32D.0(4053189)<ETX>d
<SOH>R1<STX>5:310.1(1)<ETX>p
<STX>7-5:310.1(0.93002)<ETX>
<SOH>R1<STX>6:225.0(1)<ETX>u
<STX>6:225.0(2* bar)<ETX>l
<SOH>R1<STX>3:V.A(3;2003-09-15,00:00:00;;1)<ETX>J
<STX>(11)<ETX>z

*************************************************
*Формат запроса архива:
*	<S0H> R 3 <STX> [k]: V. [a] ([p]; [v]; [b]; [t]) <ETX> <BCC>
* где	k - номер архива
*			a - атрибут архивных данных (см. ReadOut_LIS200_Gen_ru_a.pdf) 
*			p - номер колонки архива, по которой выполняется операция отбора
*			v -  первый критерий отбора (младшее значение)
*			b -  второй критерий отбора (старшее значение)
*			t -  количество строк в блоке ответа
*
*Пример запроса данных архива 3 (интервального), начиная с 
*00:00 15.09.03 и до текущего момента времени, по 
*одной записи в ответе.
*
*************************************************
         [R37:V.0(3;2015-02-23,00:00:00;2015-02-27,00:00:00;1)]
<SOH>R3<STX>3:V.0(3;2003-09-15,00:00:00;;1)<ETX>9	

<STX>(9247)(7677)(2003-09-15,00:00:00)(67999.4606)(68053.5921)(71464)(71522)(1.00785)(8.86)(1)(0.9634)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)(
<ACK>
<STX>(9248)(7678)(2003-09-15,01:00:00)(67999.4606)(68053.5921)(71464)(71522)(1.00794)(8.69)(1)(0.96408)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9249)(7679)(2003-09-15,02:00:00)(67999.4606)(68053.5921)(71464)(71522)(1.00802)(8.2)(1)(0.96584)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)(
<ACK>
<STX>(9250)(7680)(2003-09-15,03:00:00)(67999.4606)(68053.5921)(71464)(71522)(1.00799)(7.63)(1)(0.96774)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9251)(7681)(2003-09-15,04:00:00)(68000.4294)(68054.5609)(71465)(71523)(1.00803)(7.35)(1)(0.96878)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9252)(7682)(2003-09-15,05:00:00)(68000.4294)(68054.5609)(71465)(71523)(1.00798)(7.01)(1)(0.96988)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9253)(7683)(2003-09-15,06:00:00)(68005.2778)(68059.4093)(71470)(71528)(1.00778)(7.01)(1)(0.9697)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)"
<ACK>
<STX>(9254)(7684)(2003-09-15,07:00:00)(68013.0222)(68067.1537)(71478)(71536)(1.00789)(7.36)(1)(0.96861)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9255)(7685)(2003-09-15,08:00:00)(68098.2725)(68152.404)(71567)(71625)(1.00775)(9.95)(1)(0.95962)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)#
<ACK>
<STX>(9256)(7686)(2003-09-15,09:00:00)(68173.9969)(68228.1284)(71647)(71705)(1.00759)(13.92)(1)(0.9462)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)
<ACK>
<STX>(9263)(7687)(2003-09-15,10:00:00)(68213.2371)(68267.3686)(71689)(71747)(1.00756)(18.08)(1)(0.93267)(0)(0)(0)(0)(15)(0x8104)(CRC Ok)<ETX>+
<ACK>
<SOH>W1<STX>4:170.0(0)<ETX>p - от ПК, закрыть замок потребителя
<ACK>	- подтверждение записи от ЕК

*****************************************************************
*завершение сеанса (<SOH>B0<ETX><BCC> два раза). 
*(сеанс так же завершается по таймауту бездействия, около 2 мин)
*****************************************************************
<SOH>B0<ETX>q
<SOH>B0<ETX>q  


