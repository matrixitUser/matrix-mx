!function(a,b,c,d){"use strict";function e(){}function f(){return!1}function g(){return!0}function h(a,b){return function(){b.apply(a,arguments)}}function i(a){return a*(Math.PI/180)}function j(a){return a*(180/Math.PI)}function k(a,b,c){return a>b?a:b>c?c:b}function l(a){var c=a.data("events");return c!==b?c:(c=q.data(a,"events"),c!==b?c:(c=q._data(a,"events"),c!==b?c:(c=q._data(a[0],"events"),c!==b?c:b)))}function m(a,b,c,d){3==arguments.length&&"boolean"!=typeof c&&(d=c,c=!1);var e;return function(){var f=arguments;d=d||this,c&&!e&&a.apply(d,f),clearTimeout(e),e=setTimeout(function(){!c&&a.apply(d,f),e=null},b)}}function n(a,b,c){var d,e;return function(){d||(e=arguments,c=c||this,a.apply(c,e),d=setTimeout(function(){d=null},b))}}a.dnd={},a.dnd.version="0.1.7";var o,p,q=a.element,r=(q(c),q(d)),s=a.forEach,t=a.extend;!function(){var a=navigator.userAgent;/webkit\//i.test(a)?(o="-webkit-transform",p="-webkit-transform-origin"):/gecko\//i.test(a)?(o="-moz-transform",p="-moz-transform-origin"):/trident\//i.test(a)?(o="-ms-transform",p="ms-transform-origin"):/presto\//i.test(a)?(o="-o-transform",p="-o-transform-origin"):(o="transform",p="transform-origin")}(),a.dnd={noop:e,doTrue:g,doFalse:f,proxy:h,radToDeg:j,degToRad:i,getNumFromSegment:k,findEvents:l,throttle:n,debounce:m},Number.prototype.round!=b&&console.warning("Number.prototype.round is defined"),Number.prototype.round=function(a){isNaN(a)&&(a=0);var b=Math.pow(10,a);return Math.round(this*b)/b};var u=function(){function a(a,b){"object"==typeof a&&(b=a.y||a.top,a=a.x||a.left),this.x=a||0,this.y=b||0}return a.prototype={equal:function(b){return b instanceof a||(b=new a(b)),this.x===b.x&&this.y===b.y},plus:function(b){return b instanceof a||(b=new a(b)),new a(this.x+b.x,this.y+b.y)},minus:function(b){return b instanceof a||(b=new a(b)),new a(this.x-b.x,this.y-b.y)},scale:function(b){return new a(this.x*b,this.y*b)},magnitude:function(){return this.distance(new a(0,0),this)},distance:function(b){return b instanceof a||(b=new a(b)),Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},angle:function(a,b){var c=Math.atan2(a.y-this.y,a.x-this.x);return b===!0&&(c*=180/Math.PI),c},deltaAngle:function(a,c,d){c=c==b?{x:0,y:0}:c;var e=this.angle(c)-a.angle(c);return 0>e&&(e=2*Math.PI+e),d===!0&&(e*=180/Math.PI),e},transform:function(a){return a.transformPoint(this)},deltaTransform:function(a){return a.deltaTransformPoint(this)},rotate:function(a,b){var c=(new v).rotate(a,b);return this.transform(c)},getAsCss:function(){return{top:this.y,left:this.x}}},function(b,c){return new a(b,c)}}(),v=function(){function a(a,c,d,e,f,g){this.a=a!==b?a:1,this.b=c||0,this.c=d||0,this.d=e!==b?e:1,this.tx=f||0,this.ty=g||0}a.prototype={concat:function(b){return new a(this.a*b.a+this.c*b.b,this.b*b.a+this.d*b.b,this.a*b.c+this.c*b.d,this.b*b.c+this.d*b.d,this.a*b.tx+this.c*b.ty+this.tx,this.b*b.tx+this.d*b.ty+this.ty)},inverse:function(){var b=this.a*this.d-this.b*this.c;return new a(this.d/b,-this.b/b,-this.c/b,this.a/b,(this.c*this.ty-this.d*this.tx)/b,(this.b*this.tx-this.a*this.ty)/b)},rotate:function(b,c){var d=new a(Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b));return c&&(d=this.translate(c.x,c.y).concat(d).translate(-c.x,-c.y)),this.concat(d)},scale:function(b,c,d){c=c||b;var e=a(b,0,0,c);return d&&(e=e.translate(d.x,d.y).translate(-d.x,-d.y)),e},translate:function(b,c){var d=new a(1,0,0,1,b,c);return this.concat(d)},transformPoint:function(a){return new u(this.a*a.x+this.c*a.y+this.tx,this.b*a.x+this.d*a.y+this.ty)},deltaTransformPoint:function(a){return new u(this.a*a.x+this.c*a.y,this.b*a.x+this.d*a.y)},toStyle:function(){return"matrix("+this.a.round(3)+", "+this.b.round(3)+", "+this.c.round(3)+", "+this.d.round(3)+", "+this.tx.round(3)+", "+this.ty.round(3)+")"}};var c=function(b,c,d,e,f,g){return new a(b,c,d,e,f,g)};return c.IDENTITY=new a,c.HORIZONTAL_FLIP=new a(-1,0,0,1),c.VERTICAL_FLIP=new a(1,0,0,-1),c}(),w=function(){function a(a,b,c,d){this.tl=a,this.tr=b,this.bl=c,this.br=d}a.prototype={applyMatrix:function(c,d){var e,f,g,h,i=v(1,0,0,1,d.x,d.y),j=v(1,0,0,1,-d.x,-d.y);return d!=b?(e=this.tl.transform(j).transform(c).transform(i),f=this.tr.transform(j).transform(c).transform(i),g=this.bl.transform(j).transform(c).transform(i),h=this.br.transform(j).transform(c).transform(i)):(e=this.tl.transform(c),f=this.tr.transform(c),g=this.bl.transform(c),h=this.br.transform(c)),new a(e,f,g,h)},width:function(){var a=this.tl.x-this.tr.x,b=this.tl.y-this.tr.y;return Math.sqrt(a*a+b*b)},height:function(){var a=this.tl.x-this.bl.x,b=this.tl.y-this.bl.y;return Math.sqrt(a*a+b*b)},client:function(){var a=Math.min(this.tl.y,this.tr.y,this.bl.y,this.br.y),b=Math.min(this.tl.x,this.tr.x,this.bl.x,this.br.x),c=Math.max(this.tl.y,this.tr.y,this.bl.y,this.br.y)-a,d=Math.max(this.tl.x,this.tr.x,this.bl.x,this.br.x)-b;return{top:a.round(1),left:b.round(1),height:c.round(1),width:d.round(1),bottom:(a+c).round(1),right:(b+d).round(1)}},getAngle:function(){var a=this.tl.y-this.tr.y,b=this.tl.x-this.tr.x;return 180*Math.tan(b/a)/Math.PI}};var c=function(b,c,d,e){var f=arguments;return"object"==typeof f[0]&&(c=f[0].top,b=f[0].left,d=f[0].width,e=f[0].height),new a(u(b,c),u(b+d,c),u(b,c+e),u(b+d,c+e))};return c.fromPoints=function(b,c,d,e){return new a(b,c,d,e)},c}();t(q.prototype,{dndDisableSelection:function(){this.on("dragstart selectstart",f).dndCss({"-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none"})},dndEnableSelection:function(){this.off("dragstart selectstart",f).dndCss({"-moz-user-select":"auto","-khtml-user-select":"auto","-webkit-user-select":"auto"})},dndClientRect:function(){if(this[0]){var a=this[0]===c?{top:0,bottom:0,left:0,right:0,width:0,height:0}:this[0].getBoundingClientRect();return{bottom:a.bottom,height:a.height,left:a.left,right:a.right,top:a.top,width:a.width}}},dndStyleRect:function(){var a=this.dndCss(["width","height","top","left"]),b=parseFloat(a.width),c=parseFloat(a.height),d="auto"==a.top?0:parseFloat(a.top),e="auto"==a.left?0:parseFloat(a.left);return{top:d,right:e+b,bottom:d+c,left:e,width:b,height:c}},dndGetParentScrollArea:function(){var a,b,e,f,g,h,i,j,k=this.dndParents(),l=d.documentElement;return s(k,function(c){return j=q(c).dndCss(["padding-top","padding-right","padding-bottom","padding-left"]),b=c.scrollWidth,e=c.clientWidth,f=c.scrollHeight,g=c.clientHeight,i=parseFloat(j["padding-top"])+parseFloat(j["padding-bottom"]),h=parseFloat(j["padding-left"])+parseFloat(j["padding-right"]),b-h!==e||f-i!==g?(a=c,!1):void 0}),l&&a===l&&(a=c),q(a)},dndGetFirstNotStaticParent:function(){var a,b,c=this.dndParents();return s(c,function(c){return b=q(c).dndCss("position"),"absolute"===b||"relative"===b||"fixed"===b?(a=c,!1):void 0}),a||(a=d.documentElement),q(a)},dndParents:function(){for(var a=this[0].parentElement,b=[];a;)b.push(a),a=a.parentElement;return q(b)},dndGetAngle:function(a){var b=this.dndCss(o);if("none"==b||""==b)return 0;var c=b.split("(")[1].split(")")[0].split(","),d=c[0],e=c[1],f=Math.atan2(e,d);return f=0>f?f+=2*Math.PI:f,a?Math.round(180*f/Math.PI):f},dndCss:function(){function a(a){return a.replace(e,function(a,b,c,d){return d?c.toUpperCase():c}).replace(f,"Moz$1")}function d(){var a=arguments;if(1==a.length&&(a[0]instanceof Array||"string"==typeof a[0]))return j(this,a[0]);if(1==a.length&&"object"==typeof a[0])return i(this,a[0]);if(2==a.length){var b={};return b[a[0]]=a[1],i(this,b)}return this}var e=/([\:\-\_\.]+(.))/g,f=/^moz([A-Z])/,g={};!function(){var a={width:["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],height:["paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"]};s(a,function(a,b){g[b]={get:function(d){var e=c.getComputedStyle(d),f=e[b];if("border-box"!=e.boxSizing||"%"==f[f.length-1])return f;f=parseFloat(f);for(var g=0;g<a.length;g++)f-=parseFloat(e[a[g]]);return f+"px"}}})}();var h={columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},i=function(b,c){var d={};for(var e in c){var f=c[e];"number"!=typeof f||h[e]||(f+="px"),d[a(e)]=f}return b.css(d),b},j=function(a,d){var e={};if(!a[0])return b;var f=a[0].style,h=c.getComputedStyle(a[0],null);if("string"==typeof d)return f[d]?f[d]:g[d]&&"get"in g[d]?g[d].get(a[0]):h.getPropertyValue(d);for(var i=0;i<d.length;i++)e[d[i]]=f[d[i]]?f[d[i]]:g[d[i]]&&"get"in g[d[i]]?g[d[i]].get(a[0]):h.getPropertyValue(d[i]);return e};return d}()});var x=a.module("dnd",[]);!function(){function e(a){this.dnd=a,this.manipulator=new l(a),this.mousedown=h(this,this.mousedown),this.mousemove=h(this,this.mousemove),this.mouseup=h(this,this.mouseup),this.manipulator.getClientAxis=this.getClientAxis,a.$el.on("mousedown",this.mousedown)}function f(a,b){this.te=b,this.manipulator=new l(a),this.touchstart=h(this,this.touchstart),this.touchmove=h(this,this.touchmove),this.touchend=h(this,this.touchend),this.manipulator.getClientAxis=this.getClientAxis,a.$el.on(this.te.start,this.touchstart)}var g=function(){function a(a){b[a]||(b[a]=[]),this.layer=function(){return a}}var b={};return a.prototype={get:function(){return b[this.layer()]},remove:function(a){var b=this.get().indexOf(a);b>-1&&this.get().splice(b,1)},has:function(a){return this.get().indexOf(a)>-1},add:function(a){if(!this.has(a)){this.get().push(a);var b=this;q(a).on("$destroy",function(){b.remove(a)})}}},a}(),i=function(){function a(a,b){this.el=a,this.$el=q(a),this.listeners={dragstart:[],drag:[],dragend:[],dragenter:[],dragover:[],dragleave:[],drop:[]},this.regions=new g(b),this.layer=function(){return b},this.propagation=!0}var b=["dragstart","drag","dragend","dragenter","dragover","dragleave","drop"],h=["dragstart","drag","dragend"],i=["dragenter","dragover","dragleave","drop"];h.has=i.has=function(a){return this.indexOf(a)>-1};var j;return j="ontouchstart"in d.documentElement?{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}:"pointerEnabled"in c.navigator?{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}:"msPointerEnabled"in c.navigator?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"}:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},a.prototype={_isEmptyListeners:function(a){if(a instanceof Array){for(var b=0;b<a.length;b++)if(!this._isEmptyListeners(a[b]))return!1}else if(this.listeners[a].length>0)return!1;return!0},addListener:function(a,d){return-1==b.indexOf(a)?void console.log("jquery.dnd: invalid event name - ",a):(this.listeners[a].push(d),void(i.has(a)?this.regions.add(this.el):!h.has(a)||this.mouse||this.touch||("onmousedown"in c&&(this.mouse=new e(this)),("ontouchstart"in c||"onmsgesturechange"in c)&&(this.touch=new f(this,j)))))},removeListener:function(a,b){var c=arguments;if(0===c.length)for(var d in this.listeners)this.listeners[d].length=0;else if(1===c.length)this.listeners[a].length=0;else for(var e=this.listeners[a],f=0;f<e.length;f++)e[f]===b&&e[a].splice(f,1);this._isEmptyListeners(i)?this.regions.remove(this.el):this._isEmptyListeners(h)&&this.destroy()},trigger:function(a,b,c){for(var d=0;d<this.listeners[a].length;d++)this.listeners[a][d].call(this.$el,b,c)},destroy:function(){this.mouse&&(this.mouse.destroy(),delete this.mouse),this.touch&&(this.touch.destroy(),delete this.touch)}},a}(),j=function(){function a(a){this._manipulator=a}return a.prototype={setAxisOffset:function(a,b,c,d){this._manipulator.setAxisOffset(a,b,c,d)},getAxisOffset:function(){this._manipulator.getAxisOffset()},getAxis:function(){return this._manipulator.getAxis()},getRelativeAxis:function(){return this._manipulator.getRelativeAxis()},getDragTarget:function(){return this._manipulator.dnd.el},getDropTarget:function(){return this._manipulator.target},getEvent:function(){return this._manipulator.event},isTarget:function(){return this._manipulator.isTarget()},unTarget:function(){this._manipulator.removeFromTargets()},useAsPoint:function(a){return this._manipulator.asPoint=a===!1?!1:!0},setBounderElement:function(a){this._manipulator.$bounder=a,this.clearCache()},setReferenceElement:function(a){this._manipulator.$reference=a},getBorders:function(){return this._manipulator.getBorders()},getReferencePoint:function(){return this._manipulator.getReferencePoint()},clearCache:function(){this._manipulator.clearCache()}},a}(),l=function(){function b(a){this.dnd=a,this.onscroll=h(this,this.onscroll)}var c=[];return b.prototype={setAxisOffset:function(a,b,c,d){this.axisOffset={},"object"==typeof a&&(b=a.right,c=a.bottom,d=a.left,a=a.top),this.axisOffset.top=a,this.axisOffset.right=b,this.axisOffset.bottom=c,this.axisOffset.left=d,this.clearCache()},getAxisOffset:function(){return this.axisOffset},getBorders:function(){if(this.$bounder){var a=this.getCache("borders");if(!a){var b=this.$bounder.dndClientRect(),c=this.getAxisOffset();a=this.setCache("borders",{top:b.top+c.top,left:b.left+c.left,right:b.right+c.right,bottom:b.bottom+c.bottom})}return a}},getReferencePoint:function(){var a=this.getCache("referencePoint");if(!a){var b=this.$reference.dndClientRect(),c=this.getAxisOffset();a=this.setCache("referencePoint",u(b.left+c.left,b.top+c.top))}return a},getAxis:function(){var a=this.getClientAxis(),b=this.getBorders();return b?u(k(b.left,a.x,b.right),k(b.top,a.y,b.bottom)):a},getRelativeAxis:function(){return this.getAxis().minus(this.getReferencePoint())},addToTargets:function(){c.push(this)},removeFromTargets:function(){for(var a;-1!==a;)a=c.indexOf(this),a>-1&&c.splice(a,1)},getTarget:function(){return c[0]},isTarget:function(){return this.getTarget()===this},start:function(){this.started=!0,this.targets=[],this.asPoint=!1,this.setAxisOffset(0,0,0,0),this.api=new j(this),this.$scrollarea=this.dnd.$el.dndGetParentScrollArea(),this.$reference=this.dnd.$el.dndGetFirstNotStaticParent(),this.$scrollarea.on("scroll",this.onscroll),this.dnd.trigger("dragstart",this.api)},onscroll:function(){this.clearCache(),this.dnd.trigger("drag",this.api)},getCache:function(a){return this.cache[a]},setCache:function(a,b){return this.cache[a]=b},clearCache:function(){this.cache={}},stop:function(){if(this.$scrollarea.off("scroll",this.onscroll),this.targets.length)for(var a=0,b=this.targets.length;b>a;a++)q(this.targets[a]).data("dnd")[this.dnd.layer()].trigger("drop",this.api,this.dnd.el);this.dnd.trigger("dragend",this.api,this.targets)},prepareRegions:function(){var a=this.dnd.regions.get(),b=[];for(var c in a){var d=q(a[c]).data("dnd")[this.dnd.layer()],e=d.$el.dndClientRect();this.dnd!==d&&b.push({dnd:d,rect:e})}return b},begin:function(b){this.addToTargets(),this.event=b,this.started=!1,this.clearCache(),a.element(d.body).dndDisableSelection()},progress:function(a){this.event=a,this.started||this.start();var b=this.getCache("regions");b||(b=this.setCache("regions",this.prepareRegions())),this.dnd.trigger("drag",this.api);for(var c=this.getAxis(),d=c.x,e=c.y,f=this.getAxisOffset(),g=this.asPoint,h=0;h<b.length;h++){var i=b[h],j=g?d>i.rect.left&&d<i.rect.left+i.rect.width&&e>i.rect.top&&e<i.rect.top+i.rect.height:d-f.right>i.rect.left&&d-f.left<i.rect.left+i.rect.width&&e-f.bottom>i.rect.top&&e-f.top<i.rect.top+i.rect.height,k=this.targets.indexOf(i.dnd.el);j?-1===k?(this.targets.push(i.dnd.el),i.dnd.trigger("dragenter",this.api,this.dnd.el)):i.dnd.trigger("dragover",this.api,this.dnd.el):-1!==k&&(q(this.targets[k]).data("dnd")[this.dnd.layer()].trigger("dragleave",this.api,this.dnd.el),this.targets.splice(k,1))}},end:function(b){this.event=b,this.started&&this.stop(),a.element(d.body).dndEnableSelection(),this.removeFromTargets()}},b}();e.prototype={getClientAxis:function(a){return a=a?a:this.event,u(a.clientX,a.clientY)},mousedown:function(a){this.manipulator.begin(a),r.on("mousemove",this.mousemove),r.on("mouseup",this.mouseup)},mousemove:function(a){this.manipulator.progress(a)},mouseup:function(a){this.manipulator.end(a),r.off("mousemove",this.mousemove),r.off("mouseup",this.mouseup)},destroy:function(){this.dnd.$el.off("mousedown",this.mousedown)}},f.prototype={getClientAxis:function(a){return a=a?a:this.event,a=a.originalEvent?a.originalEvent:a,u(a.changedTouches[0].clientX,a.changedTouches[0].clientY)},touchstart:function(a){this.manipulator.begin(a),r.on(this.te.move,this.touchmove),r.on(this.te.end+" "+this.te.cancel,this.touchend)},touchmove:function(a){a.preventDefault(),this.manipulator.progress(a)},touchend:function(a){this.manipulator.end(a),r.off(this.te.move,this.touchmove),r.off(this.te.end+" "+this.te.cancel,this.touchend)},destroy:function(){this.dnd.$el.off(this.te.start,this.touchstart)}},q.prototype.dndBind=function(a,c){if(!this.length)return this;var d,e,f,g=[];if("object"==typeof a){e=a;for(var h in e){d=h.replace(/\s+/g," ").split(" ");for(var j=0;j<d.length;j++)g.push({event:d[j],handler:e[h]})}}else{if("string"!=typeof a||"function"!=typeof c)return this;d=a.trim().replace(/\s+/g," ").split(" ");for(var j=0;j<d.length;j++)g.push({event:d[j],handler:c})}return g.length?(s(this,function(d){var e=q(d).data();e.dnd||(e.dnd={});for(var h=0;h<g.length;h++)a=g[h].event,c=g[h].handler,a=a.split("."),a[1]===b&&(a[1]=a[0],a[0]="common"),f=a[0],a=a[1],e.dnd[f]||(e.dnd[f]=new i(d,f)),e.dnd[f].addListener(a,c)}),this):this},q.prototype.dndUnbind=function(){var a=arguments,c=[],d="common";if(!this.length)return this;if("string"==typeof a[0])if(a[0]=a[0].trim().replace(/\s+/g," ").split(" "),"function"==typeof a[1])for(var e=0;e<a[0].length;e++)c.push({event:a[0][e],handler:a[1]});else for(var e=0;e<a[0].length;e++)c.push({event:a[0][e]});else if("object"==typeof a[0])for(var f in a[0])a[0].hasOwnProperty(f)&&c.push({event:f.trim(),handler:a[0][f]});else if(0!==a.length)return this;return s(this,function(e){var f=q(e).data();if(f.dnd)if(0===a.length)for(var g in f.dnd)f.dnd[g].removeListener();else for(var h=0;h<c.length;h++){var i=c[h];if(i.event=i.event.split("."),i.event[1]==b&&(i.event[1]=i.event[0],i.event[0]=d),"*"==i.event[0])for(var g in f.dnd)f.dnd[g].removeListener(i.event[1]);else f.dnd[i.event[0]]&&(i.handler?f.dnd[i.event[0]].removeListener(i.event[1],i.handler):f.dnd[i.event[0]].removeListener(i.event[1]))}}),this}}(),x.factory("EventEmitter",[function(){function a(){var a={};this.on=function(b,c){a[b]=a[b]||[],a[b].push(c)},this.off=function(b,c){if(a[b])for(var d=0,e=a[b].length;e>d;d++)a[b][d]===c&&a[b].splice(d,1)},this.trigger=function(b,c){a[b]=a[b]||[],c=c||"string"==typeof c?[c]:[],a[b].forEach(function(a){a.apply(this,c)})}}return a}]),x.directive("dndDraggable",["$timeout","$parse","$http","$compile","$q","$templateCache","EventEmitter",function(c,e,f,g,h,i){var j=function(){function a(a,b){var c=a.dndCss("position");"fixed"!=c&&"absolute"!=c&&"relative"!=c&&(c="relative",a.dndCss("position",c)),this.element=a,this.rect=b}return a.prototype={getCorrectedOffset:function(a){var b={},c=this.element.dndClientRect();return b.top=a.y-c.top,b.left=a.x-c.left,b.bottom=b.top-c.height,b.right=b.left-c.width,b},init:function(){delete this.start},updatePosition:function(a){this.start||(this.start=u(this.element.dndStyleRect()).minus(a));var b=u(this.start).plus(a);this.rect?this.rect.update(b.getAsCss()):this.element.dndCss(b.getAsCss())},destroy:function(){}},a}(),k=function(){function b(b,c,d){function e(b){return b=a.isFunction(b)?b():b,f.get(b,{cache:i}).then(function(a){g.template=a.data})}var g=this;this.mainElement=b,this.scope=d,this._inited=!1,this.templateUrl=c,"clone"!==c&&e(c)}var c=q('<div class = "angular-dnd-helper"></div>').dndCss({position:"absolute"});return b.prototype={init:function(){return delete this.start,delete this.element,"clone"===this.templateUrl?this.createElementByClone().wrap().appendTo(this.mainElement.parent()):this.compile(this.scope).wrap().appendTo(this.mainElement.parent()),this.scope.$apply(),this},createElementByClone:function(){return this.element=this.mainElement.clone(),this.element.dndCss("position","static"),this},compile:function(){return this.element=g(this.template)(this.scope),this},wrap:function(){return c.html(""),c.append(this.element),this},appendTo:function(a){return a.append(c),this},getCorrectedOffset:function(){var a={},b=c.dndClientRect();return a.top=b.height,a.left=b.width,a.bottom=0,a.right=0,a},updatePosition:function(a){c.dndCss(a.getAsCss())},destroy:function(){this.element.remove()}},b}();return{require:["?dndRect","?dndModel","?^dndContainer"],scope:!0,link:function(f,g,h,i){function l(c){o=!1;var e=u(f);if(e=e===b?!0:e,e||c.unTarget(),c.isTarget()){if(z.init(),o=!0,c.useAsPoint(v.useAsPoint),c.dragmodel=q?q.get():null,v.restrictTheMovement){var g=r?r.getElement():a.element(d.body);c.setBounderElement(g)}f.$dragged=!0,c.setAxisOffset(z.getCorrectedOffset(c.getAxis())),w(f,{$dragmodel:c.dragmodel,$dropmodel:c.dropmodel,$api:c}),f.$apply()}}function m(a){o&&(z.updatePosition(a.getRelativeAxis()),x(f,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a}),f.$apply())}function n(a){o&&(z.destroy(),y(f,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a}),c(function(){f.$dragged=!1}))}var o,p=i[0],q=i[1],r=i[2],s={layer:"common",useAsPoint:!1,helper:null,restrictTheMovement:!0},u=e(h.dndDraggable),v=t({},s,e(h.dndDraggableOpts)(f)||{}),w=e(h.dndOnDragstart),x=e(h.dndOnDrag),y=e(h.dndOnDragend),z=v.helper?new k(g,v.helper,f):new j(g,p),A={};A[v.layer+".dragstart"]=l,A[v.layer+".drag"]=m,A[v.layer+".dragend"]=n,g.dndBind(A),f.$dragged=!1}}}]),x.directive("dndDroppable",["$parse","$timeout",function(a){return{require:"?dndModel",scope:!0,link:function(c,d,e,f){function g(a){var d=a.droplocal={};d.droppable=l(c),d.droppable=d.droppable===b?!0:d.droppable,d.droppable&&(a.dropmodel=f?f.get():f,n(c,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a}),c.$apply())}function h(a){var b=a.droplocal;b.droppable&&(o(c,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a}),c.$apply())}function i(a){var d=a.droplocal;d.droppable&&(p(c,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a}),a.dropmodel=b,c.$apply())}function j(a){q(c,{$dragmodel:a.dragmodel,$dropmodel:a.dropmodel,$api:a})}var k={layer:"common"},l=a(e.dndDroppable),m=t({},k,a(e.dndDroppableOpts)(c)||{}),n=a(e.dndOnDragenter),o=a(e.dndOnDragover),p=a(e.dndOnDragleave),q=a(e.dndOnDrop),r={};r[m.layer+".dragenter"]=g,r[m.layer+".dragover"]=h,r[m.layer+".dragleave"]=i,r[m.layer+".drop"]=j,d.dndBind(r)}}}]),x.directive("dndResizable",["$parse","$timeout",function(c,d){function e(b){return a.element("<div></div>").addClass("angular-dnd-resizable-handle angular-dnd-resizable-handle-"+b)}function f(a,b){return b="object"==typeof b?b:{x:1,y:1},u(a.left+a.width*b.x/2,a.top+a.height*b.y/2)}return{require:["?dndRect"],scope:!0,link:function(a,g,h,i){function j(c){function e(c){var d=c.local={};if(d.resizable=n(a),d.resizable=d.resizable===b?!0:d.resizable,d.resizable||c.unTarget(),c.isTarget()){d.started=!0,d.$parent=g.parent(),d.rads=g.dndGetAngle(),d.rotateMatrix=v.IDENTITY.rotate(d.rads),d.inverseRotateMatrix=d.rotateMatrix.inverse(),d.parentRect=d.$parent.dndClientRect();var e=c.getAxis(),f=g.dndClientRect(),h=d.rect=g.dndStyleRect();d.borders=c.getBorders(),d.startAxis=e,d.minScaleX=o.minWidth/h.width,d.minScaleY=o.minHeight/h.height,d.maxScaleX=o.maxWidth/h.width,d.maxScaleY=o.maxHeight/h.height,d.deltaX=f.left-h.left+f.width/2-h.width/2,d.deltaY=f.top-h.top+f.height/2-h.height/2,a.$resized=!0,p(a),a.$apply()}}function h(b){var d=b.local;if(d.started){var e=b.getAxis(),h=u(e).minus(d.startAxis).transform(d.inverseRotateMatrix),i={x:1,y:1},j=d.rect.width,m=d.rect.height,n=d.rect.top,o=d.rect.left;switch(c){case"n":i.y=(m-h.y)/m;break;case"e":i.x=(j+h.x)/j;break;case"s":i.y=(m+h.y)/m;break;case"w":i.x=(j-h.x)/j;break;case"ne":i.x=(j+h.x)/j,i.y=(m-h.y)/m;break;case"se":i.x=(j+h.x)/j,i.y=(m+h.y)/m;break;case"sw":i.x=(j-h.x)/j,i.y=(m+h.y)/m;break;case"nw":i.x=(j-h.x)/j,i.y=(m-h.y)/m}i.x=k(d.minScaleX,i.x,d.maxScaleX),i.y=k(d.minScaleY,i.y,d.maxScaleY);var p,r=f(d.rect),s=f(d.rect,i);switch(c){case"n":p=u(o,n+m*i.y).rotate(d.rads,s).minus(u(o,n+m).rotate(d.rads,r));break;case"e":p=u(o,n).rotate(d.rads,s).minus(u(o,n).rotate(d.rads,r));break;case"s":p=u(o,n).rotate(d.rads,s).minus(u(o,n).rotate(d.rads,r));break;case"w":p=u(o+j*i.x,n).rotate(d.rads,s).minus(u(o+j,n).rotate(d.rads,r));break;case"ne":p=u(o,n+m*i.y).rotate(d.rads,s).minus(u(o,n+m).rotate(d.rads,r));break;case"se":p=u(o,n).rotate(d.rads,s).minus(u(o,n).rotate(d.rads,r));break;case"sw":p=u(o+j*i.x,n).rotate(d.rads,s).minus(u(o+j,n).rotate(d.rads,r));break;case"nw":p=u(o+j*i.x,n+m*i.y).rotate(d.rads,s).minus(u(o+j,n+m).rotate(d.rads,r))}var t={};t.width=j*i.x,t.height=m*i.y,t.left=o-p.x,t.top=n-p.y;var v=u(t.left+d.deltaX+t.width/2,t.top+d.deltaY+t.height/2),x=w(t.left+d.deltaX,t.top+d.deltaY,t.width,t.height).applyMatrix(d.rotateMatrix,v).client();d.borders&&(x.left+1<d.borders.left||x.top+1<d.borders.top||x.right-1>d.borders.right||x.bottom-1>d.borders.bottom)||(l?l.update(t):g.dndCss(t),q(a),a.$apply())}}function i(b){var c=b.local;c.started&&(r(a),d(function(){a.$resized=!1}))}return{"$$resizable.dragstart":e,"$$resizable.drag":h,"$$resizable.dragend":i}}var l=i[0],m={handles:"ne, se, sw, nw, n, e, s, w",minWidth:20,minHeight:20,maxWidth:1e4,maxHeight:1e4},n=c(h.dndResizable),o=t({},m,c(h.dndResizableOpts)(a)||{}),p=c(h.dndOnResizestart),q=c(h.dndOnResize),r=c(h.dndOnResizeend),s=g.dndCss("position");"fixed"!=s&&"absolute"!=s&&"relative"!=s&&(s="relative",g.dndCss("position",s));for(var x=o.handles.replace(/\s/g,"").split(","),y=0;y<x.length;y++)g.append(e(x[y]).dndBind(j(x[y])));a.$resized=!1}}}]),x.directive("dndRotatable",["$parse","$timeout",function(c,d){return{require:["?dndRect"],scope:!0,link:function(e,f,g,h){function k(a){var c=a.local={};if(c.rotatable=p(e),c.rotatable=c.rotatable===b?!0:c.rotatable,c.rotatable||a.unTarget(),a.isTarget()){c.started=!0;{var d=a.getRelativeAxis();f.dndClientRect()}c.srect=f.dndStyleRect(),c.currAngle=f.dndGetAngle(),c.startPoint=u(d),c.borders=a.getBorders(),c.center=u(c.srect).plus(u(c.srect.width/2,c.srect.height/2)),console.log(c.center.y),e.$rotated=!0,r(e),e.$apply()}}function l(a){var b=a.local;if(b.started){var c=a.getRelativeAxis(),d=u(c).deltaAngle(b.startPoint,b.center),g=j(b.currAngle+d);g=Math.round(g/q.step)*q.step;var h=i(g),k=v().rotate(h),l=w(b.center.x-b.srect.width/2,b.center.y-b.srect.height/2,b.srect.width,b.srect.height).applyMatrix(k,b.center).client();b.borders&&(l.left<b.borders.left-1||l.top<b.borders.top-1||l.left+l.width>b.borders.right+1||l.top+l.height>b.borders.bottom+1)||(n?n.update("transform",k.toStyle()):f.dndCss("transform",k.toStyle()),s(e),e.$apply())}}function m(a){var b=a.local;b.started&&(x(e),d(function(){e.$rotated=!1}))}var n=h[0],o={step:5},p=c(g.dndRotatable),q=t({},o,c(g.dndRotatableOpts)(e)||{}),r=c(g.dndOnRotatestart),s=c(g.dndOnRotate),x=c(g.dndOnRotateend),y=f.dndCss("position");"fixed"!=y&&"absolute"!=y&&"relative"!=y&&(y="relative",f.dndCss("position",y));var z=a.element('<div class = "angular-dnd-rotatable-handle"></div>');f.append(z),e.$rotated=!1;var A={"$$rotatable.dragstart":k,"$$rotatable.drag":l,"$$rotatable.dragend":m};z.dndBind(A)}}}]),x.directive("dndSortable",["$parse","$compile",function(b){var c,d=/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/;return{scope:!0,transclude:!0,template:function(a,b){var c=a[0].nodeName.toLowerCase(),e=b.ngRepeat||"",f=e.match(d);if(!f)throw"dnd-sortable-item requires ng-repeat as dependence";var g="common";return"<"+c+" ng-transclude dnd-draggable dnd-draggable-opts = \"{helper:'clone', restrictTheMovement:false, useAsPoint: true, layer: '"+g+"'}\" dnd-droppable dnd-droppable-opts = \"{layer: '"+g+'\'}"dnd-on-dragstart = "$$onDragStart($api, $dropmodel, $dragmodel)"dnd-on-dragend = "$$onDragEnd($api, $dropmodel, $dragmodel)"dnd-on-dragover = "$$onDragOver($api, $dropmodel, $dragmodel)"dnd-model = "{item: '+f[1]+", list: "+f[2]+', index: $index}"></'+c+">"},replace:!0,link:function(d,f,g){function h(a,b){{var c=f.dndClientRect();f[0].offsetWidth>a.offsetWidth,f[0].offsetHeight>a.offsetHeight}return(q?(b.x-c.left)/c.width:(b.y-c.top)/c.height)>.5}function i(a,b,c,d){d=d||b,d.splice(c,0,b.splice(a,1)[0])}var j=f[0].parentNode,k=a.element(j),l="common",m=k.data("dnd-sortable");m&&m[l]||(m=m||{},m[l]=!0,k.dndBind({dragover:function(a){console.log(a.getEvent().target,o(d).list.length),a.getEvent().target!==j||o(d).list.length||k.append(c[0])}}).data("dnd-sortable",m));var n={},o=(b(g.dndSortableItem),t({},n,b(g.dndSortableItemOpts)(d)||{}),b(g.dndModel)||e),p=f.dndCss(["float","display"]),q=/left|right|inline/.test(p.float+p.display);d.$$onDragStart=function(a){f.dndClientRect();c=f.clone(),f.addClass("ng-hide"),c.addClass("angular-dnd-placeholder"),j.insertBefore(c[0],f[0]),a.$sortable={},a.clearCache()},d.$$onDragEnd=function(a){if(f.removeClass("ng-hide"),c.addClass("ng-hide"),a.$sortable.model){var b=d.$index,e=a.$sortable.model.index,g=o(d).list,h=a.$sortable.model.list;h===g?b>e?a.$sortable.insertBefore||e++:a.$sortable.insertBefore&&e--:a.$sortable.insertBefore||e++,i(b,g,e,h),a.clearCache(),d.$apply()}},d.$$onDragOver=function(a){var b=h(a.getDragTarget(),a.getAxis());b?j.insertBefore(c[0],f[0].nextSibling):j.insertBefore(c[0],f[0]),a.$sortable.model=o(d),a.$sortable.insertBefore=!b,a.clearCache()}}}}]),x.factory("DndLasso",[function(){function a(a){this.getRect=function(){return this.isActive?a.rect:b},this.getClientRect=function(){return this.isActive?f.dndClientRect():b},this.isActive=function(){return a.active}}function c(b){var c=b.isTarget(),d=new a(this);this.isTarget=function(){return c},this.handler=function(){return d},this.getEvent=function(){return b.getEvent()}}function e(a){function b(b){var d=b.local=new c(b);return d.isTarget()?(d.active=!0,i.trigger("start",d.handler()),b.setReferenceElement(a.$el),d.startAxis=b.getRelativeAxis(),f.removeAttr("class style").removeClass("ng-hide").addClass(a.className),void a.$el.append(f)):void i.trigger("start",d.handler())}function e(b){var c=b.local;if(!c.active)return void i.trigger("drag",c.handler());var d=b.getRelativeAxis().minus(c.startAxis),e={top:c.startAxis.y,left:c.startAxis.x,width:d.x,height:d.y};e.width<0&&(e.width=-e.width,e.left=e.left-e.width),e.height<0&&(e.height=-e.height,e.top=e.top-e.height),c.rect=e,e.top+=a.offsetY,e.left+=a.offsetX,f.dndCss(e),i.trigger("drag",c.handler())}function h(a){var b=a.local;return b.active?(f.addClass("ng-hide"),q(d.body).append(f),void i.trigger("end",b.handler())):void i.trigger("end",b.handler())}var i=this;a=t({},g,a);var j={"$$lasso.dragstart":b,"$$lasso.drag":e,"$$lasso.dragend":h};a.$el.dndBind(j),this.destroy=function(){a.$el.dndUnbind()};var k={};this.on=function(a,b){k[a]=k[a]||[],k[a].push(b)},this.trigger=function(a,b){k[a]=k[a]||[],b=b||"string"==typeof b?[b]:[],k[a].forEach(function(a){a.apply(this,b)})}}var f=q("<div></div>").dndCss({position:"absolute"}),g={className:"angular-dnd-lasso",offsetX:0,offsetY:0};return e}]),x.directive("dndLassoArea",["DndLasso","$parse","$timeout","dndKey",function(a,c,d){function e(){var a=[],c={};this.data=function(){return c},this.add=function(b){a.push(b)},this.remove=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return a.splice(c,1),!0;return!1},this.getSelectable=function(c){for(var d=0;d<a.length;d++)if(a[d].getElement()[0]==c)return a[d];return b},this.empty=function(){return!a.length},this.get=function(c){return c===b?a:a[c]}}e.$inject=[];var f=[];return f.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return this.splice(b,1),!0;return!1},{restrict:"A",controller:e,require:"dndLassoArea",priority:-1,link:function(b,e,g,h){function i(a){if(!h.empty()){if(o)return void m.toggleSelected();for(var c=h.get(),d=0;d<c.length;d++)c[d].unselected().unselecting();m&&m.selected()}v(b,{$event:a}),b.$apply()}function j(a){if(b.$dragged=!0,a.isActive()){if(r(b),!h.empty()&&!o)for(var c=h.get(),d=0;d<c.length;d++)c[d].unselected().unselecting();b.$apply()}}function k(a){if(b.$dragged=!0,a.isActive()){if(!h.empty())for(var c=h.get(),d=a.getClientRect(),e=0;e<c.length;e++)c[e].hit(d)?c[e].selecting():c[e].unselecting();
s(b,{$rect:a.getRect()}),b.$apply()}}function l(a){if(a.isActive()){var c=h.get();if(!h.empty()){for(var e=0;e<c.length;e++)c[e].isSelecting()&&c[e].toggleSelected();b.$apply()}if(u(b,{$rect:a.getRect()}),!h.empty()){for(var e=0;e<c.length;e++)c[e].unselecting();b.$apply()}d(function(){b.$dragged=!1})}}var m,o,p={selectAdditionals:!0},q=(c(g.dndLassoArea),t({},p,c(g.dndLassoAreaOpts)(b)||{})),r=c(g.dndLassoOnstart),s=c(g.dndLassoOndrag),u=c(g.dndLassoOnend),v=c(g.dndLassoOnclick),w=new a({$el:e});f.push(h),e.on("mousedown touchstart",n(function(a){b.$dragged=!1,b.$keypressed=o=q.selectAdditionals?a.shiftKey||a.ctrlKey||a.metaKey:!1,h.empty()||(m=h.getSelectable(a.target)),b.$apply()},300)),e.on("click",function(a){b.$dragged||i(a),b.$keypressed&&d(function(){b.$keypressed=!1})}),w.on("start",j),w.on("drag",k),w.on("end",l),e.on("$destroy",function(){f.remove(h),b.$apply()}),b.$dragged=!1}}}]),x.directive("dndSelectable",["$parse",function(a){function c(c,d,f){var g=a(d.dndModelSelecting),h=g.assign||e,i=a(d.dndModelSelected),j=i.assign||e,k=a(d.dndSelectable),l=(k.assign||e,a(d.dndOnSelected)),m=a(d.dndOnUnselected),n=a(d.dndOnSelecting),o=a(d.dndOnUnselecting);j(c,!1),h(c,!1),this.getElement=function(){return f},this.isSelected=function(){return i(c)},this.isSelecting=function(){return g(c)},this.isSelectable=function(){var a=k(c);return a===b||a},this.toggleSelected=function(a){return a=a===b?!this.isSelected():a,a?this.selected():this.unselected()},this.selecting=function(){return this.isSelectable()&&n(c)!==!1&&h(c,!0),this},this.unselecting=function(){return o(c)!==!1&&h(c,!1),this},this.selected=function(){return this.isSelectable()&&l(c)!==!1&&j(c,!0),this},this.unselected=function(){return m(c)!==!1&&j(c,!1),this},this.hit=function(a){var c=this.rectCtrl.getClient();for(var d in c)c[d]=parseFloat(c[d]);return c.bottom=c.bottom==b?c.top+c.height:c.bottom,c.right=c.right==b?c.left+c.width:c.right,a.bottom=a.bottom==b?a.top+a.height:a.bottom,a.right=a.right==b?a.left+a.width:a.right,a.top<=c.top&&c.top<=a.bottom&&(a.left<=c.left&&c.left<=a.right||a.left<=c.right&&c.right<=a.right)||a.top<=c.bottom&&c.bottom<=a.bottom&&(a.left<=c.left&&c.left<=a.right||a.left<=c.right&&c.right<=a.right)||a.left>=c.left&&a.right<=c.right&&(c.top<=a.bottom&&a.bottom<=c.bottom||c.bottom>=a.top&&a.top>=c.top||a.top<=c.top&&a.bottom>=c.bottom)||a.top>=c.top&&a.bottom<=c.bottom&&(c.left<=a.right&&a.right<=c.right||c.right>=a.left&&a.left>=c.left||a.left<=c.left&&a.right>=c.right)||a.top>=c.top&&a.right<=c.right&&a.bottom<=c.bottom&&a.left>=c.left}}function d(a){this.$element=a}return c.$inject=["$scope","$attrs","$element"],d.prototype={getClient:function(){return this.$element.dndClientRect()}},{restrict:"A",require:["dndSelectable","^dndLassoArea","?dndRect"],controller:c,scope:!0,link:function(c,f,g,h){function i(){h[1].remove(h[0]),c.$$phase||c.$apply()}c.$dndSelectable=h[0];var j=h[2];h[0].rectCtrl=j?j:new d(f),h[1].add(h[0]),f.on("$destroy",i);var k=a(g.dndOnSelected),l=a(g.dndOnUnselected),m=a(g.dndOnSelecting),n=a(g.dndOnUnselecting);(k||l)&&(k=k||e,l=l||e,c.$watch(g.dndModelSelected,function(a,d){a!==b&&d!==b&&a!==d&&(a?k(c):l(c))})),(m||n)&&(m=m||e,n=n||e,c.$watch(g.dndModelSelecting,function(a,d){a!==b&&d!==b&&a!==d&&(a?m(c):n(c))}))}}}]),x.directive("dndModel",["$parse",function(a){function b(b,c){var d=a(c.dndModel),e=d.assign;this.set=function(a){e(b,a)},this.get=function(){return d(b)}}return b.$inject=["$scope","$attrs"],{restrict:"A",controller:b}}]),x.directive("dndContainer",["$parse",function(){function a(a){this.getElement=function(){return a}}return a.$inject=["$element"],{restrict:"EAC",controller:a}}]),x.factory("dndKey",["$rootScope",function(a){function b(){}function c(b){var c=b.keyCode;f(b),e.indexOf(c)>-1||(e.push(c),a.$digest())}function d(b){var c=b.keyCode,d=e.indexOf(c);-1!==d&&(e.splice(d,1),a.$digest())}var e=[];b.prototype={get:function(){return e},isset:function(a){var b=e.indexOf(a);return-1!==b}};var f=m(d,1e3);return r.on("keydown",c),r.on("keyup",d),new b}]),x.directive("dndKeyModel",["$parse","dndKey",function(a,c){return{restrict:"A",link:function(d,e,f){var g=a(f.dndKeyModel),h=g.assign;d.$watch(function(){return c.get()},function(a){a!==b&&h(d,a)})}}}]),x.directive("dndRect",["$parse",function(a){function c(c,f,g){function h(a){var c;a="object"==typeof a?a:{};for(var f=0;f<d.length;f++){var h=d[f];a[h]===b&&(c||(c=g.dndCss(e)),a[h]="transform"==h?"none"==c[o]?"matrix(1, 0, 0, 1, 0, 0)":c[o]:c[h])}for(var i in a)a[i.toLowerCase()]=a[i];for(var i in a)d.has(i)?"number"==typeof a[i]&&(a[i]=a[i]+"px"):delete a[i];return a}var i,j=a(f.dndRect),k=j.assign;this.update=function(a,e){var f,g=j(c)||{};"object"!=typeof a?(f={},f[a]=e):f=a;for(var h=0;h<d.length;h++){var i=d[h];f[i]!==b&&(g[i]=f[i])}k(c,g)},this.get=function(){return j(c)},this.getClient=function(){return g.dndClientRect()},c.$parent.$watch(function(){var a=j(c.$parent);a!==i&&k(c,a)}),c.$watch(f.dndRect,function(a,c){if(a&&"object"==typeof a){c==b&&(c={});for(var e,f=(a=h(a),{}),i=0;i<d.length;i++)e=d[i],a[e]==b&&c[e]!=b?f[e]="":a[e]!=b&&(f[e]=a[e]);f.transform&&(f[o]=f.transform),g.dndCss(f)}},!0)}var d=["top","left","width","height","transform"],e=["top","left","width","height",o];return d.has=function(a){return this.indexOf(a)>-1},c.$inject=["$scope","$attrs","$element"],{restrict:"A",controller:c}}]),x.directive("dndFittext",["$timeout","$window",function(a,c){function e(a){var a=h.text(a).html().replace(/\s+/g," ");return("INPUT"==h[0].tagName||"TEXTAREA"==h[0].tagName)&&(a=a.replace(/\s/g,"&nbsp;")),a}function f(a,b){h.html(e(a)).dndCss(b);var c=h[0].getBoundingClientRect();return{width:parseFloat(c.width),height:parseFloat(c.height)}}function g(a,b,c){var d=a[0].getBoundingClientRect();return{width:parseFloat(d.width)*(100-b)/100,height:parseFloat(d.height)*(100-c)/100}}var h=q("<span></span>").dndCss({position:"absolute",left:-99999,top:-99999,opacity:0,"z-index":-9999});return q(d.body).append(h),{restrict:"A",link:function(a,d,e){function h(c){c=c===b?{}:c;var h=d.dndCss(["font-size","font-family","font-weight","text-transform","border-top","border-right","border-bottom","border-left","padding-top","padding-right","padding-bottom","padding-left"]),i=c.text==b?d.text():c.text,j=[];c.width===b&&j.push("width"),c.height===b&&j.push("height"),j&&(j=d.dndCss(j));for(var l in j){var m=j[l];if("%"==m[m.length-1])return;c[l]=j[l]}var n=f(i,h),o=g(d,0,0);if(!n.width||!n.height)return void d.dndCss("font-size","");o.width=parseFloat(c.width),o.height=parseFloat(c.height);var p=o.height/n.height,q=o.width/n.width,r=a.$eval(e.dndFittextMax),s=a.$eval(e.dndFittextMin);s==b&&(s=0),r==b&&(r=Number.POSITIVE_INFINITY);var t=q>p?p:q;if(t*=.85,!(t>.95&&1>=t||t>=1&&1.05>t)){var u=t*parseFloat(h["font-size"]);u=k(s,u,r),d.dndCss("font-size",u+"px")}}a.$watch(e.dndFittext,n(function(a){h(a)}),!0),q(c).on("resize",function(){h()})}}}])}(angular,void 0,window,document);